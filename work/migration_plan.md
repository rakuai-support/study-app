# データ移行とWebアプリケーション化の構想

## 1. 目的

現在のTSVファイルベースのデータ管理から、より堅牢で拡張性の高いSQLiteデータベースへ移行し、将来的にはマルチユーザー対応のWebアプリケーション（SaaS）への展開を視野に入れた技術基盤を構築することを目的とします。

## 2. データ移行計画（フェーズ1）

### 2.1. データベース設計

まず、現在のTSVファイルと`localStorage`に分散しているデータを、一元的に管理するためのSQLiteデータベースを設計します。

**テーブル1: `learning_items` (学習項目マスター)**

| カラム名 | 型 | 説明 |
| :--- | :--- | :--- |
| `identifier` | TEXT | 主キー。学習項目ID。 |
| `subject` | TEXT | 教科（国語, 数学など）。 |
| `grade` | INTEGER | 学年。 |
| `learning_objective` | TEXT | 学習目標。 |
| `learning_prompt` | TEXT | 学習プロンプト。 |
| `keywords` | TEXT | キーワード（JSON配列の文字列として保存）。 |
| `difficulty` | TEXT | 難易度。 |
| `content_types` | TEXT | コンテンツ制作プロンプト（JSON形式の文字列）。 |

**テーブル2: `progress` (進捗管理)**

| カラム名 | 型 | 説明 |
| :--- | :--- | :--- |
| `id` | INTEGER | 主キー（自動採番）。 |
| `user_id` | TEXT | ユーザーを識別するID。 |
| `item_identifier` | TEXT | `learning_items`のIDと連携。 |
| `level` | TEXT | 'beginnerGoals', 'intermediateGoals', 'advancedGoals'のいずれか。 |
| `goal_index` | INTEGER | 各レベルの何番目のゴールかを示すインデックス。 |
| `completed` | INTEGER | 完了したかどうか (0: 未完了, 1: 完了)。 |
| `updated_at` | TEXT | 最終更新日時。 |

### 2.2. 移行手順

1.  **移行スクリプトの作成:** `migrate_data_v2.py` を作成し、`学習指導要領アプリ - データ.tsv` からデータを読み込み、上記のテーブル設計に従って `study_app_v2.db` というSQLiteファイルにデータを挿入する処理を実装します。
2.  **スクリプトの実行:** `python migrate_data_v2.py` を実行し、データベースファイルを生成します。
3.  **アプリケーションの修正:** `study_app.py` を修正し、データの読み込み元をTSVファイルからSQLiteデータベースに変更します。また、進捗管理ロジックを`localStorage`から`progress`テーブルへの読み書きに変更します。

## 3. Webアプリケーション化構想（フェーズ2）

データベース移行後、以下のステップで本格的なWebアプリケーションへの拡張を目指します。

### 3.1. ユーザー認証機能の実装

- Flask-Loginなどのライブラリを導入し、ユーザー登録、ログイン、ログアウト機能を実装します。
- `users`テーブル（`id`, `username`, `password_hash`など）をデータベースに新設します。
- `progress`テーブルの`user_id`を、この`users`テーブルのIDと紐付けます。

### 3.2. AI (Gemini) APIキーの管理方法

- **プランA（クレジット制）:** ユーザーがサービス内で利用できる「AIクレジット」を購入するシステムを導入。AI機能を利用するたびにクレジットを消費する方式。Stripe等の決済APIとの連携が必要。
- **プランB（サブスクリプション制）:** 開発者側でAPIキーを用意し、有料プランのユーザーに月間の利用回数制限付きで提供する。こちらも決済システムとの連携が必要。
- **プランC（ユーザーキー設定の維持）:** 無料プランでは、従来通りユーザー自身のAPIキーを設定してもらう。有料プランでは開発者キーを利用可能にするハイブリッド案。

### 3.3. デプロイとインフラ

- **デプロイ:** Heroku, Vercel, AWS Elastic BeanstalkなどのPaaSを利用し、アプリケーションをインターネット上に公開します。
- **データベース:** 開発初期はSQLiteで問題ありませんが、ユーザー数の増加に伴い、PostgreSQLやMySQLといったより堅牢なデータベースへの移行を検討します。
- **ドメイン:** 独自のドメインを取得し、サービスに設定します。

### 3.4. 機能拡張案

- **学習ダッシュボード:** ユーザーが自身の学習進捗や得意・不得意分野を視覚的に把握できるページ。
- **コミュニティ機能:** ユーザー同士が質問したり、成果物を共有したりできる掲示板やフォーラム。
- **保護者向け機能:** 保護者が子供の学習状況を（子供の許可のもと）見守ることができる機能。
