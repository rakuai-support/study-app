# GEMINI.md: 現状のアプリケーション概要

## 1. アプリケーション概要

このアプリケーションは、学習指導要領に基づいた741の学習項目を、ユーザーが自分のペースで学べるように設計されたWebアプリケーションです。

特に、不登校の子供たちをメインターゲットに想定しており、AIアシスタントによる優しいサポートや、創造性を刺激するプロジェクト型学習を通して、プレッシャーなく学習を進められる環境を提供することを目的としています。

## 2. 技術スタック

- **バックエンド:** Python, Flask
- **フロントエンド:** HTML, CSS, JavaScript
- **データストレージ:**
  - **学習項目データ:** SQLite (`study_app.db`)
  - **ユーザー進捗データ:** SQLite (`study_app.db`)
- **AI機能:** Google Gemini API (APIキーはユーザーが各自で設定)

## 3. 主要ファイル構成

- `study_app.py`: Flaskアプリケーション本体。ルーティング、データ処理、API連携などを担当。
- `study_app.db`: 学習項目とユーザー進捗を格納するSQLiteデータベース。
- `templates/`: HTMLテンプレート群。
  - `base.html`: 全ページの基礎となるレイアウト。
  - `index.html`: トップページ。学習項目を一覧表示。
  - `content.html`: 個別の学習項目の詳細ページ。
- `static/`: CSS、JavaScriptファイル群。
  - `style.css`: アプリ全体のデザイン定義。
  - `script.js`: 基本的なUIの挙動を制御。
  - `api-manager.js`: Gemini APIキーの管理とAI呼び出しを担当。
  - `progress-manager.js`: 学習進捗のサーバーとの同期、表示更新を担当。
  - `ai-assistant.js`: フローティングAIアシスタントのUIと対話ロジックを担当。
- `migrations/`: データベースの構造を変更するためのスクリプト群。

## 4. データ管理

### 4.1. 学習項目データ

- **移行経緯:** 当初は`学習指導要領アプリ - データ.tsv`で管理していましたが、拡張性を考慮し、`migrations/001_tsv_to_sqlite.py`スクリプトによってSQLiteデータベース (`study_app.db`) の`learning_items`テーブルに移行されました。
- **現在の仕様:** アプリケーション起動時に`study_app.db`から全学習項目をメモリ（pandas DataFrame）に読み込んで使用します。

### 4.2. ユーザー進捗データ

- **移行経緯:** 当初は各ブラウザの`localStorage`に保存していましたが、デバイス間で進捗を同期させるため、サーバーサイドでの管理に移行しました。
- **現在の仕様:**
    - ユーザーの学習進捗（どの項目のどのゴールを達成したか）は、`study_app.db`の`progress`テーブルに記録されます。
    - フロントエンド(`progress-manager.js`)は、進捗の変更があるたびにバックエンドのAPI (`/api/progress/...`) を呼び出し、データベースを更新します。
    - これにより、PCやスマートフォンなど、異なるデバイスでアクセスしても常に同じ進捗状況が共有されます。
    - （補足）現状、ユーザー認証機能はないため、すべてのユーザーの進捗が`default_user`という単一のIDで記録されています。

## 5. 実行方法

以下のコマンドでアプリケーションを起動します。

```shell
py study_app.py
```

起動後、Webブラウザで `http://localhost:5000` にアクセスすることで利用可能です。

スマートフォンなど、同じネットワーク内の他のデバイスからアクセスする場合は、PCのIPアドレス（例: `http://192.168.11.32:5000`）を指定します。