<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ã€ä¸­å­¦ç”Ÿç‰ˆã€‘AIå­¦ç¿’ã‚¢ãƒ—ãƒªï¼ˆmanabuwaï¼‰{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="{% if request.endpoint == 'index' %}homepage{% endif %}">
    <a href="#main-content" class="skip-to-content">ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¹ã‚­ãƒƒãƒ—</a>
    <header class="header" role="banner">
        <div class="container">
            <a href="{{ url_for('index') }}" style="text-decoration: none; color: inherit;">
                <h1 class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    ä¸­å­¦ç”Ÿç‰ˆ-manabuwa
                </h1>
            </a>
            <nav class="nav">
                
                <!-- èªè¨¼çŠ¶æ…‹ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ -->
                <div id="authNav">
                    <!-- ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®è¡¨ç¤º -->
                    <div id="loggedInNav" style="display: none;">
                        <a href="{{ url_for('index') }}" class="nav-link">
                            <i class="fas fa-home"></i> ãƒ›ãƒ¼ãƒ 
                        </a>
                        <div class="user-info">
                            <span class="user-email" id="userEmail"></span>
                            <span class="usage-count" id="usageCount">0/30</span>
                            <span class="premium-badge" id="premiumBadge" style="display: none;">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </span>
                        </div>
                        <button id="logoutBtn" class="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                        </button>
                    </div>
                    
                    <!-- æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®è¡¨ç¤º -->
                    <div id="notLoggedInNav">
                        <a href="/login" class="nav-link">
                            <i class="fas fa-sign-in-alt"></i> ãƒ­ã‚°ã‚¤ãƒ³
                        </a>
                        <a href="/register" class="nav-link">
                            <i class="fas fa-user-plus"></i> æ–°è¦ç™»éŒ²
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main id="main-content" class="main" role="main">
        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 ã‹ã‚ã•ãæ¥½AIã‚µãƒãƒ¼ãƒˆ. All rights reserved.</p>
        </div>
    </footer>

    <!-- åˆ©ç”¨åˆ¶é™è¶…éãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="usageLimitModal" class="usage-limit-modal">
        <div class="usage-limit-content">
            <button class="modal-close-btn" onclick="closeUsageLimitModal()">&times;</button>
            <h3>ğŸ ç„¡æ–™åˆ©ç”¨å›æ•°ã‚’è¶…éã—ã¾ã—ãŸ</h3>
            <p>ä»Šæœˆã®ç„¡æ–™åˆ©ç”¨å›æ•°ï¼ˆ30å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚</p>
            
            <div class="upgrade-options">
                <h4>ğŸš€ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½ã§ç¶™ç¶šåˆ©ç”¨</h4>
                <ul>
                    <li>âœ… AIæ©Ÿèƒ½: ç„¡åˆ¶é™åˆ©ç”¨</li>
                    <li>âœ… å„ªå…ˆã‚µãƒãƒ¼ãƒˆ</li>
                </ul>
                
                <div class="upgrade-buttons">
                    <a href="https://your-website.com/premium" 
                       class="upgrade-btn" target="_blank">
                        ğŸ›’ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ è³¼å…¥
                    </a>
                    <button class="upgrade-btn secondary" 
                            onclick="showActivationForm()">
                        ğŸ”‘ èªè¨¼ã‚³ãƒ¼ãƒ‰å…¥åŠ›
                    </button>
                </div>
            </div>
            
            <div id="activationForm" class="activation-form" style="display: none;">
                <h4>ğŸ”‘ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ èªè¨¼</h4>
                <p>æ±ºæ¸ˆå®Œäº†å¾Œã«é€ä¿¡ã•ã‚ŒãŸèªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                
                <input type="text" id="activationCode" 
                       placeholder="èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›" class="activation-input">
                <button onclick="activatePremium()" class="upgrade-btn">èªè¨¼</button>
                
                <div class="help-text">
                    <p>èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒå±Šã‹ãªã„å ´åˆã¯ã€
                       <a href="admin@smilefactory-rakuai.com" target="_blank">ã‚µãƒãƒ¼ãƒˆ</a>
                       ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
                </div>
            </div>
            
            <button class="upgrade-btn secondary" 
                    onclick="closeUsageLimitModal()" style="margin-top: 1rem;">
                é–‰ã˜ã‚‹
            </button>
        </div>
    </div>

    <!-- AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®Ÿè¡Œãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="aiPromptModal" class="ai-modal">
        <div class="ai-modal-content">
            <div class="ai-modal-header">
                <h3><i class="fas fa-robot"></i> AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h3>
                <button class="modal-close" onclick="closeAiModal()">&times;</button>
            </div>
            <div class="ai-modal-body">
                <div class="prompt-section">
                    <label for="promptText">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:</label>
                    <textarea id="promptText" class="prompt-textarea" rows="8" placeholder="AIã«é€ä¿¡ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç¢ºèªãƒ»ç·¨é›†ã—ã¦ãã ã•ã„..."></textarea>
                </div>
                <div class="content-type-display">
                    <span id="currentContentType" class="content-type-badge"></span>
                </div>
            </div>
            <div class="ai-modal-footer">
                <button id="executeAI" class="btn btn-primary btn-execute">
                    <i class="fas fa-magic"></i> å®Ÿè¡Œ
                    <span class="loading-spinner" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </span>
                </button>
            </div>
            <div class="ai-result-section">
                <div id="aiResult" class="ai-result"></div>
            </div>
        </div>
    </div>

    
    <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ -->
    <div id="floatingAiAssistant" class="floating-ai-assistant">
        <button id="aiAssistantBtn" class="ai-assistant-btn" onclick="toggleAiAssistant()" 
                aria-label="AIå­¦ç¿’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’é–‹ã" tabindex="0">
            <i class="fas fa-robot" aria-hidden="true"></i>
        </button>
        <div id="aiAssistantTooltip" class="ai-assistant-tooltip" role="tooltip">
            AIå­¦ç¿’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
        </div>
    </div>

    <!-- AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="aiAssistantModal" class="ai-assistant-modal">
        <div class="ai-assistant-modal-content">
            <div class="ai-assistant-header">
                <h3><i class="fas fa-robot"></i> AIå­¦ç¿’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h3>
                <button class="ai-assistant-close" onclick="closeAiAssistant()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="ai-assistant-body">
                <div id="aiChatContainer" class="ai-chat-container">
                    <div class="ai-chat-welcome">
                        <div class="welcome-message">
                            <i class="fas fa-graduation-cap"></i>
                            <h4>ã“ã‚“ã«ã¡ã¯ï¼AIå­¦ç¿’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™</h4>
                            <p id="contextMessage">å­¦ç¿’ã«é–¢ã™ã‚‹ã“ã¨ãªã‚‰ä½•ã§ã‚‚ãŠèããã ã•ã„</p>
                        </div>
                    </div>
                    <div id="aiChatMessages" class="ai-chat-messages">
                        <!-- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>
                <div class="ai-chat-input-area">
                    <div class="quick-questions" id="quickQuestions">
                        <!-- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¿œã˜ãŸã‚¯ã‚¤ãƒƒã‚¯è³ªå• -->
                    </div>
                    <div class="ai-chat-input-wrapper">
                        <textarea id="aiChatInput" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." class="ai-chat-input" rows="2"></textarea>
                        <button id="aiChatSend" class="ai-chat-send-btn" onclick="sendAiMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆå›ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="tutorialModal" class="tutorial-modal" role="dialog" aria-labelledby="tutorialTitle" aria-describedby="tutorialDesc">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <h3 id="tutorialTitle"><i class="fas fa-graduation-cap" aria-hidden="true"></i> ã‚ˆã†ã“ãï¼å­¦ç¿’ã‚¢ãƒ—ãƒªã‚¬ã‚¤ãƒ‰</h3>
                <button class="tutorial-close" onclick="window.closeTutorial()" aria-label="ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‰ã˜ã‚‹">&times;</button>
            </div>
            <div class="tutorial-body">
                <div class="tutorial-step active" data-step="1">
                    <div class="tutorial-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h4>ğŸ‰ ã‚ˆã†ã“ãï¼</h4>
                    <p>å­¦ç¿’æŒ‡å°è¦é ˜ã‚¢ãƒ—ãƒªã¸ã‚ˆã†ã“ãï¼<br>
                    ã‚ãªãŸå°‚ç”¨ã®å­¦ç¿’ã®æ—…ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚</p>
                    <div class="tutorial-features">
                        <div class="feature-item">
                            <i class="fas fa-chart-line"></i>
                            <span>é€²æ—ç®¡ç†</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-robot"></i>
                            <span>AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-star"></i>
                            <span>é”æˆæ„Ÿã‚·ã‚¹ãƒ†ãƒ </span>
                        </div>
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="2">
                    <div class="tutorial-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h4>ğŸ“Š é€²æ—ç®¡ç†ã®ä½¿ã„æ–¹</h4>
                    <p>å„å­¦ç¿’é …ç›®ã«ã¯3æ®µéšã®ã‚´ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ï¼š</p>
                    <ul class="tutorial-list">
                        <li><i class="fas fa-seedling"></i> <strong>åˆå¿ƒè€…ã‚´ãƒ¼ãƒ«</strong> - åŸºç¤ã‹ã‚‰å§‹ã‚ã‚ˆã†</li>
                        <li><i class="fas fa-tree"></i> <strong>ä¸­ç´šè€…ã‚´ãƒ¼ãƒ«</strong> - ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—</li>
                        <li><i class="fas fa-trophy"></i> <strong>ä¸Šç´šè€…ã‚´ãƒ¼ãƒ«</strong> - ãƒã‚¹ã‚¿ãƒ¼ãƒ¬ãƒ™ãƒ«</li>
                    </ul>
                    <p>ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é€²æ—ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼</p>
                </div>
                
                <div class="tutorial-step" data-step="3">
                    <div class="tutorial-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h4>ğŸ¤– AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®æ´»ç”¨</h4>
                    <p>å³ä¸‹ã®AIãƒœã‚¿ãƒ³ã§å­¦ç¿’ã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ã‚‰ã‚Œã¾ã™ï¼š</p>
                    <ul class="tutorial-list">
                        <li><i class="fas fa-question-circle"></i> å­¦ç¿’å†…å®¹ã®è³ªå•</li>
                        <li><i class="fas fa-lightbulb"></i> ã‚¢ã‚¤ãƒ‡ã‚¢ã®ææ¡ˆ</li>
                        <li><i class="fas fa-magic"></i> ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶ä½œæ”¯æ´</li>
                    </ul>
                    <p class="tutorial-note">ğŸ’¡ æœˆ30å›ã¾ã§ç„¡æ–™ã§ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™</p>
                </div>
                
                <div class="tutorial-step" data-step="4">
                    <div class="tutorial-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <h4>â­ é”æˆæ„Ÿã‚·ã‚¹ãƒ†ãƒ </h4>
                    <p>å­¦ç¿’ã‚’ç¶šã‘ã‚‹ã¨ç´ æ•µãªæ¼”å‡ºãŒå¾…ã£ã¦ã„ã¾ã™ï¼š</p>
                    <ul class="tutorial-list">
                        <li><i class="fas fa-trophy"></i> ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆæ¼”å‡º</li>
                        <li><i class="fas fa-medal"></i> ãƒãƒƒã‚¸ãƒ»å®Ÿç¸¾ã‚·ã‚¹ãƒ†ãƒ </li>
                        <li><i class="fas fa-chart-bar"></i> è©³ç´°ãªé€²æ—çµ±è¨ˆ</li>
                    </ul>
                    <p>ã‚ãªãŸã®é ‘å¼µã‚Šã‚’ã—ã£ã‹ã‚Šã¨è¨˜éŒ²ã—ã¾ã™ï¼</p>
                </div>
            </div>
            <div class="tutorial-footer">
                <div class="tutorial-progress">
                    <div class="progress-dots">
                        <span class="dot active" data-step="1" onclick="alert('ãƒ‰ãƒƒãƒˆ1ã‚¯ãƒªãƒƒã‚¯'); console.log('ãƒ‰ãƒƒãƒˆ1ã‚¯ãƒªãƒƒã‚¯');"></span>
                        <span class="dot" data-step="2" onclick="alert('ãƒ‰ãƒƒãƒˆ2ã‚¯ãƒªãƒƒã‚¯'); console.log('ãƒ‰ãƒƒãƒˆ2ã‚¯ãƒªãƒƒã‚¯');"></span>
                        <span class="dot" data-step="3" onclick="alert('ãƒ‰ãƒƒãƒˆ3ã‚¯ãƒªãƒƒã‚¯'); console.log('ãƒ‰ãƒƒãƒˆ3ã‚¯ãƒªãƒƒã‚¯');"></span>
                        <span class="dot" data-step="4" onclick="alert('ãƒ‰ãƒƒãƒˆ4ã‚¯ãƒªãƒƒã‚¯'); console.log('ãƒ‰ãƒƒãƒˆ4ã‚¯ãƒªãƒƒã‚¯');"></span>
                    </div>
                </div>
                <div class="tutorial-buttons">
                    <button id="tutorialPrev" class="tutorial-btn secondary" onclick="alert('å‰ã¸ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯!'); console.log('å‰ã¸ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯!');" disabled>
                        <i class="fas fa-chevron-left"></i> å‰ã¸
                    </button>
                    <button id="tutorialNext" class="tutorial-btn primary" onclick="alert('æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯!'); console.log('æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯!'); document.querySelector('.tutorial-step.active').classList.remove('active'); document.querySelector('[data-step=\\'2\\']').classList.add('active');">
                        æ¬¡ã¸ <i class="fas fa-chevron-right"></i>
                    </button>
                    <button id="tutorialStart" class="tutorial-btn primary" onclick="alert('å­¦ç¿’é–‹å§‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯!'); console.log('å­¦ç¿’é–‹å§‹!');" style="display: none;">
                        <i class="fas fa-rocket"></i> å­¦ç¿’ã‚’å§‹ã‚ã‚‹ï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- å­¦ç¿’çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="statisticsModal" class="statistics-modal">
        <div class="statistics-content">
            <div class="statistics-header">
                <h3><i class="fas fa-chart-bar"></i> å­¦ç¿’çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
                <button class="statistics-close" onclick="closeStatistics()">&times;</button>
            </div>
            <div class="statistics-body">
                <div class="stats-overview">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number" id="totalAchieved">0</span>
                            <span class="stat-label">é”æˆé …ç›®æ•°</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number" id="totalGoalsCompleted">0</span>
                            <span class="stat-label">å®Œäº†ã‚´ãƒ¼ãƒ«æ•°</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number" id="studyStreak">0</span>
                            <span class="stat-label">é€£ç¶šå­¦ç¿’æ—¥æ•°</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-number" id="weeklyActivity">0</span>
                            <span class="stat-label">ä»Šé€±ã®æ´»å‹•</span>
                        </div>
                    </div>
                </div>
                
                <div class="stats-charts">
                    <div class="chart-section">
                        <h4><i class="fas fa-chart-pie"></i> æ•™ç§‘åˆ¥é€²æ—</h4>
                        <div class="subject-progress" id="subjectProgressContainer">
                            <!-- æ•™ç§‘åˆ¥é€²æ—ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                        </div>
                    </div>
                    
                    <div class="chart-section">
                        <h4><i class="fas fa-chart-line"></i> æœ€è¿‘ã®æ´»å‹•</h4>
                        <div class="recent-activity">
                            <div class="activity-timeline" id="activityTimeline">
                                <!-- æ´»å‹•å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-achievements">
                    <h4><i class="fas fa-medal"></i> å®Ÿç¸¾ãƒ»ãƒãƒƒã‚¸</h4>
                    <div class="achievements-grid" id="achievementsGrid">
                        <!-- å®Ÿç¸¾ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>
            </div>
            <div class="statistics-footer">
                <button class="stats-btn primary" onclick="exportProgress()">
                    <i class="fas fa-download"></i> é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
                <button class="stats-btn secondary" onclick="closeStatistics()">
                    é–‰ã˜ã‚‹
                </button>
            </div>
        </div>
    </div>

    <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é€²æ—ã‚«ãƒ¼ãƒ‰ -->
    <div id="floatingProgressCard" class="floating-progress-card">
        <div class="floating-progress-content">
            <div class="floating-progress-header">
                <div class="floating-progress-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="floating-progress-info">
                    <span class="floating-progress-title">å­¦ç¿’é€²æ—</span>
                    <span class="floating-progress-subtitle" id="floatingProgressText">0% å®Œäº†</span>
                </div>
                <button class="floating-progress-toggle" onclick="toggleFloatingProgress()">
                    <i class="fas fa-chevron-up" id="floatingToggleIcon"></i>
                </button>
                <button class="floating-stats-btn" onclick="showStatistics()" title="è©³ç´°çµ±è¨ˆã‚’è¡¨ç¤º">
                    <i class="fas fa-chart-bar"></i>
                </button>
            </div>
            
            <div class="floating-progress-details" id="floatingProgressDetails" style="display: none;">
                <div class="floating-progress-stats">
                    <div class="floating-stat">
                        <span class="floating-stat-number" id="floatingCompletedItems">0</span>
                        <span class="floating-stat-label">å®Œäº†é …ç›®</span>
                    </div>
                    <div class="floating-stat">
                        <span class="floating-stat-number" id="floatingCompletedGoals">0</span>
                        <span class="floating-stat-label">é”æˆã‚´ãƒ¼ãƒ«</span>
                    </div>
                    <div class="floating-stat">
                        <span class="floating-stat-number" id="floatingTotalItems">741</span>
                        <span class="floating-stat-label">ç·é …ç›®æ•°</span>
                    </div>
                </div>
                
                <div class="floating-progress-bar-container">
                    <div class="floating-progress-bar">
                        <div class="floating-progress-fill" id="floatingProgressFill" style="width: 0%;"></div>
                    </div>
                    <div class="floating-achievement-badge" id="floatingAchievementBadge">
                        <i class="fas fa-seedling"></i>
                    </div>
                </div>
                
                <div class="floating-motivation" id="floatingMotivation">
                    <i class="fas fa-heart"></i>
                    <span>å­¦ç¿’ã®æ—…ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼</span>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é€²æ—ã‚«ãƒ¼ãƒ‰é–¢æ•°ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ï¼‰
    function toggleFloatingProgress() {
        const details = document.getElementById('floatingProgressDetails');
        const icon = document.getElementById('floatingToggleIcon');
        const card = document.getElementById('floatingProgressCard');
        
        if (details && icon && card) {
            if (details.style.display === 'none' || !details.style.display) {
                details.style.display = 'block';
                icon.className = 'fas fa-chevron-down';
                card.classList.add('expanded');
            } else {
                details.style.display = 'none';
                icon.className = 'fas fa-chevron-up';
                card.classList.remove('expanded');
            }
        }
    }

    async function updateFloatingProgress() {
        if (window.progressManager) {
            try {
                console.log('ğŸ”„ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é€²æ—ã‚«ãƒ¼ãƒ‰æ›´æ–°é–‹å§‹');
                console.log('progress-manageråˆæœŸåŒ–çŠ¶æ…‹:', !!window.progressManager);
                console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:', window.progressManager.userId);
                
                const stats = await window.progressManager.getOverallStats();
                console.log('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿:', stats);
                
                const progressPercentage = Math.round(stats.overallPercentage);
                const progressTextElement = document.getElementById('floatingProgressText');
                if (progressTextElement) {
                    progressTextElement.textContent = `${progressPercentage}% å®Œäº†`;
                    console.log('é€²æ—ç‡æ›´æ–°:', progressPercentage + '%');
                }
                
                const completedItemsElement = document.getElementById('floatingCompletedItems');
                const completedGoalsElement = document.getElementById('floatingCompletedGoals');
                const totalItemsElement = document.getElementById('floatingTotalItems');
                
                if (completedItemsElement) completedItemsElement.textContent = stats.achievedIdentifiers || 0;
                if (completedGoalsElement) completedGoalsElement.textContent = (stats.completedGoals || 0).toLocaleString();
                if (totalItemsElement) totalItemsElement.textContent = stats.totalIdentifiers || 741;
                
                const progressFill = document.getElementById('floatingProgressFill');
                if (progressFill) {
                    progressFill.style.width = progressPercentage + '%';
                }
                
                updateFloatingAchievementBadge(progressPercentage);
                updateFloatingMotivation(progressPercentage, stats.achievedIdentifiers || 0);
                
                console.log('âœ… ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é€²æ—ã‚«ãƒ¼ãƒ‰æ›´æ–°å®Œäº†');
            } catch (error) {
                console.error('âŒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é€²æ—ã‚«ãƒ¼ãƒ‰ã®æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', error.stack);
            }
        } else {
            console.warn('âš ï¸ progress-managerãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
        }
    }

    function updateFloatingAchievementBadge(percentage) {
        const badge = document.getElementById('floatingAchievementBadge');
        if (!badge) return;
        const badgeIcon = badge.querySelector('i');
        if (!badgeIcon) return;
        
        if (percentage >= 90) {
            badgeIcon.className = 'fas fa-crown';
            badge.style.background = 'linear-gradient(135deg, #ffd700, #ffb347)';
        } else if (percentage >= 75) {
            badgeIcon.className = 'fas fa-trophy';
            badge.style.background = 'linear-gradient(135deg, #ff9800, #f57c00)';
        } else if (percentage >= 50) {
            badgeIcon.className = 'fas fa-star';
            badge.style.background = 'linear-gradient(135deg, #4caf50, #388e3c)';
        } else if (percentage >= 25) {
            badgeIcon.className = 'fas fa-leaf';
            badge.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        } else {
            badgeIcon.className = 'fas fa-seedling';
            badge.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        }
    }

    function updateFloatingMotivation(percentage, completedItems) {
        const motivationElement = document.getElementById('floatingMotivation');
        if (!motivationElement) return;
        const motivationSpan = motivationElement.querySelector('span');
        if (!motivationSpan) return;
        
        let message = '';
        let icon = 'fas fa-heart';
        
        if (percentage >= 90) {
            message = `ğŸ‰ ${completedItems}é …ç›®å®Œäº†ï¼ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã§ã™ï¼`;
            icon = 'fas fa-crown';
        } else if (percentage >= 75) {
            message = `ğŸ† ${completedItems}é …ç›®å®Œäº†ï¼ã‚‚ã†ã™ãã‚´ãƒ¼ãƒ«ï¼`;
            icon = 'fas fa-trophy';
        } else if (percentage >= 50) {
            message = `â­ ${completedItems}é …ç›®å®Œäº†ï¼ç´ æ™´ã‚‰ã—ã„é€²æ­©ï¼`;
            icon = 'fas fa-star';
        } else if (percentage >= 25) {
            message = `ğŸŒ¿ ${completedItems}é …ç›®å®Œäº†ï¼é †èª¿ã§ã™ï¼`;
            icon = 'fas fa-leaf';
        } else if (completedItems > 0) {
            message = `ğŸŒ± ${completedItems}é …ç›®å®Œäº†ï¼è‰¯ã„ã‚¹ã‚¿ãƒ¼ãƒˆï¼`;
            icon = 'fas fa-seedling';
        } else {
            message = 'å­¦ç¿’ã®æ—…ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼';
            icon = 'fas fa-heart';
        }
        
        const iconElement = motivationElement.querySelector('i');
        if (iconElement) iconElement.className = icon;
        motivationSpan.textContent = message;
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
    window.updateFloatingProgress = updateFloatingProgress;

    // å¤ã„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«æ©Ÿèƒ½å‰Šé™¤æ¸ˆã¿ - script.jsã‚’ä½¿ç”¨

    // ã‚¨ãƒ©ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹é–¢æ•°
    function closeErrorModal() {
        const modal = document.getElementById('errorModal');
        if (modal) {
            modal.classList.remove('show');
            setTimeout(() => modal.remove(), 300);
        }
    }

    // çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½
    function showStatistics() {
        const modal = document.getElementById('statisticsModal');
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
        updateStatisticsData();
    }

    function closeStatistics() {
        const modal = document.getElementById('statisticsModal');
        modal.classList.remove('show');
        document.body.style.overflow = '';
    }

    async function updateStatisticsData() {
        if (!window.progressManager) return;

        try {
            const stats = await window.progressManager.getOverallStats();
            
            // åŸºæœ¬çµ±è¨ˆã‚’æ›´æ–°
            document.getElementById('totalAchieved').textContent = stats.achievedIdentifiers || 0;
            document.getElementById('totalGoalsCompleted').textContent = (stats.completedGoals || 0).toLocaleString();
            
            // å­¦ç¿’streakè¨ˆç®—ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
            const studyDays = localStorage.getItem('studyDays') || '[]';
            const studyDaysArray = JSON.parse(studyDays);
            const streak = calculateStudyStreak(studyDaysArray);
            document.getElementById('studyStreak').textContent = streak;
            
            // ä»Šé€±ã®æ´»å‹•
            const thisWeekActivity = calculateWeeklyActivity(studyDaysArray);
            document.getElementById('weeklyActivity').textContent = thisWeekActivity;
            
            // æ•™ç§‘åˆ¥é€²æ—ã‚’æ›´æ–°
            await updateSubjectProgress();
            
            // æœ€è¿‘ã®æ´»å‹•ã‚’æ›´æ–°
            updateRecentActivity();
            
            // å®Ÿç¸¾ãƒãƒƒã‚¸ã‚’æ›´æ–°
            updateAchievements(stats);
            
        } catch (error) {
            console.error('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        }
    }

    function calculateStudyStreak(studyDays) {
        if (!studyDays.length) return 0;
        
        const today = new Date().toDateString();
        const sortedDays = studyDays.sort((a, b) => new Date(b) - new Date(a));
        
        let streak = 0;
        let currentDate = new Date();
        
        for (let day of sortedDays) {
            const dayDate = new Date(day).toDateString();
            const currentDateString = currentDate.toDateString();
            
            if (dayDate === currentDateString) {
                streak++;
                currentDate.setDate(currentDate.getDate() - 1);
            } else {
                break;
            }
        }
        
        return streak;
    }

    function calculateWeeklyActivity(studyDays) {
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        
        return studyDays.filter(day => new Date(day) >= oneWeekAgo).length;
    }

    async function updateSubjectProgress() {
        // PostgreSQLã‹ã‚‰å‹•çš„ã«æ•™ç§‘ãƒªã‚¹ãƒˆã‚’å–å¾—
        let subjects = [];
        try {
            const response = await fetch('/api/subjects');
            if (response.ok) {
                subjects = await response.json();
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å›ºå®šãƒªã‚¹ãƒˆ
                subjects = ['å›½èª', 'ç®—æ•°', 'æ•°å­¦', 'ç†ç§‘', 'ç¤¾ä¼š', 'è‹±èª', 'é“å¾³', 'éŸ³æ¥½', 'ç¾è¡“', 'ä¿å¥ä½“è‚²', 'æŠ€è¡“ãƒ»å®¶åº­'];
            }
        } catch (error) {
            console.error('æ•™ç§‘ãƒªã‚¹ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            subjects = ['å›½èª', 'ç®—æ•°', 'æ•°å­¦', 'ç†ç§‘', 'ç¤¾ä¼š', 'è‹±èª', 'é“å¾³', 'éŸ³æ¥½', 'ç¾è¡“', 'ä¿å¥ä½“è‚²', 'æŠ€è¡“ãƒ»å®¶åº­'];
        }
        
        // æ•™ç§‘åˆ¥é€²æ—ã‚³ãƒ³ãƒ†ãƒŠã‚’å‹•çš„ã«ç”Ÿæˆ
        const container = document.getElementById('subjectProgressContainer');
        if (container) {
            container.innerHTML = ''; // æ—¢å­˜ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢
            
            subjects.forEach(subject => {
                const subjectItem = document.createElement('div');
                subjectItem.className = 'subject-item';
                subjectItem.setAttribute('data-subject', subject);
                subjectItem.innerHTML = `
                    <span class="subject-name">${subject}</span>
                    <div class="subject-bar">
                        <div class="subject-fill" style="width: 0%"></div>
                    </div>
                    <span class="subject-percent">0%</span>
                `;
                container.appendChild(subjectItem);
            });
        }
        
        for (let subject of subjects) {
            try {
                const cards = document.querySelectorAll(`[data-subject="${subject}"]`);
                let totalItems = 0;
                let achievedItems = 0;
                
                cards.forEach(card => {
                    totalItems++;
                    const progressData = window.progressManager?.progressData;
                    if (progressData) {
                        const identifier = card.getAttribute('data-identifier');
                        if (identifier && progressData[identifier]) {
                            const progress = window.progressManager.getProgressForCard(identifier);
                            if (progress.percentage > 50) {
                                achievedItems++;
                            }
                        }
                    }
                });
                
                const percentage = totalItems > 0 ? Math.round((achievedItems / totalItems) * 100) : 0;
                
                const subjectItem = document.querySelector(`.subject-item[data-subject="${subject}"]`);
                if (subjectItem) {
                    const fill = subjectItem.querySelector('.subject-fill');
                    const percent = subjectItem.querySelector('.subject-percent');
                    
                    if (fill) fill.style.width = percentage + '%';
                    if (percent) percent.textContent = percentage + '%';
                }
            } catch (error) {
                console.error(`${subject}ã®é€²æ—æ›´æ–°ã‚¨ãƒ©ãƒ¼:`, error);
            }
        }
    }

    function updateRecentActivity() {
        const timeline = document.getElementById('activityTimeline');
        const activities = getRecentActivities();
        
        timeline.innerHTML = activities.map(activity => `
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">${activity.title}</div>
                    <div class="activity-time">${activity.time}</div>
                </div>
            </div>
        `).join('');
    }

    function getRecentActivities() {
        // å®Ÿéš›ã®å­¦ç¿’æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const studyDays = JSON.parse(localStorage.getItem('studyDays') || '[]');
        const recentActivities = JSON.parse(localStorage.getItem('recentActivities') || '[]');
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
        console.log('ğŸ” [DEBUG] studyDays:', studyDays.length, 'items');
        console.log('ğŸ” [DEBUG] recentActivities:', recentActivities.length, 'items');
        if (recentActivities.length > 0) {
            console.log('ğŸ” [DEBUG] æœ€æ–°ã®æ´»å‹•:', recentActivities.slice(-3));
        }
        
        const activities = [];
        
        // æœ€è¿‘ã®å…·ä½“çš„ãªé€²æ—æ´»å‹•ã‚’å„ªå…ˆè¡¨ç¤ºï¼ˆæœ€æ–°10ä»¶ï¼‰
        recentActivities.slice(-10).reverse().forEach(activity => {
            activities.push({
                icon: activity.icon,
                title: activity.title,
                time: formatTimeAgo(activity.timestamp)
            });
        });
        
        // å…·ä½“çš„ãªæ´»å‹•ãŒå°‘ãªã„å ´åˆã®ã¿å­¦ç¿’æ—¥ã‚’è¿½åŠ 
        if (activities.length < 3) {
            studyDays.slice(-2).reverse().forEach((studyDay, index) => {
                const timeAgo = index === 0 ? 'ä»Šæ—¥' : 'æ˜¨æ—¥';
                
                activities.push({
                    icon: 'fas fa-calendar-check',
                    title: 'å­¦ç¿’æ´»å‹•ã‚’è¨˜éŒ²',
                    time: timeAgo
                });
            });
        }
        
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º
        if (activities.length === 0) {
            return [{
                icon: 'fas fa-seedling',
                title: 'å­¦ç¿’ã‚’å§‹ã‚ã‚ˆã†ï¼',
                time: 'æœ€åˆã®ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†'
            }];
        }
        
        return activities.slice(0, 5); // æœ€æ–°5ä»¶ã‚’è¡¨ç¤º
    }
    
    function formatTimeAgo(timestamp) {
        const now = Date.now();
        const diff = now - timestamp;
        const minutes = Math.floor(diff / (1000 * 60));
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        
        if (minutes < 1) return 'ãŸã£ãŸä»Š';
        if (minutes < 60) return `${minutes}åˆ†å‰`;
        if (hours < 24) return `${hours}æ™‚é–“å‰`;
        if (days < 7) return `${days}æ—¥å‰`;
        return '1é€±é–“ä»¥ä¸Šå‰';
    }

    function updateAchievements(stats) {
        const grid = document.getElementById('achievementsGrid');
        const achievements = [
            { icon: 'ğŸŒ±', title: 'å­¦ç¿’é–‹å§‹', unlocked: stats.completedGoals > 0 },
            { icon: 'ğŸ¯', title: 'åˆå›é”æˆ', unlocked: stats.achievedIdentifiers > 0 },
            { icon: 'ğŸ”¥', title: 'ç¶™ç¶šå­¦ç¿’', unlocked: calculateStudyStreak(JSON.parse(localStorage.getItem('studyDays') || '[]')) >= 3 },
            { icon: 'â­', title: '25%é”æˆ', unlocked: stats.overallPercentage >= 25 },
            { icon: 'ğŸŒ³', title: '50%é”æˆ', unlocked: stats.overallPercentage >= 50 },
            { icon: 'ğŸ†', title: '75%é”æˆ', unlocked: stats.overallPercentage >= 75 },
            { icon: 'ğŸ‘‘', title: 'å®Œå…¨åˆ¶è¦‡', unlocked: stats.overallPercentage >= 100 },
            { icon: 'ğŸ’', title: 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆ', unlocked: stats.achievedIdentifiers >= 741 }
        ];
        
        grid.innerHTML = achievements.map(achievement => `
            <div class="achievement-badge ${achievement.unlocked ? 'unlocked' : ''}">
                <span class="achievement-icon">${achievement.icon}</span>
                <div class="achievement-title">${achievement.title}</div>
            </div>
        `).join('');
    }

    function exportProgress() {
        if (!window.progressManager) {
            alert('é€²æ—ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
            return;
        }
        
        const progressData = {
            timestamp: new Date().toISOString(),
            userId: window.progressManager.userId,
            progress: window.progressManager.progressData,
            studyDays: JSON.parse(localStorage.getItem('studyDays') || '[]')
        };
        
        const blob = new Blob([JSON.stringify(progressData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `å­¦ç¿’é€²æ—_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // å­¦ç¿’æ—¥è¨˜éŒ²ï¼ˆé€²æ—å¤‰æ›´æ™‚ã«å‘¼ã³å‡ºã—ï¼‰
    function recordStudyDay() {
        const today = new Date().toDateString();
        const studyDays = JSON.parse(localStorage.getItem('studyDays') || '[]');
        
        if (!studyDays.includes(today)) {
            studyDays.push(today);
            localStorage.setItem('studyDays', JSON.stringify(studyDays));
        }
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
    window.closeErrorModal = closeErrorModal;
    window.showStatistics = showStatistics;
    window.closeStatistics = closeStatistics;
    window.exportProgress = exportProgress;
    window.recordStudyDay = recordStudyDay;
    // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–¢æ•°ã¯script.jsã§å®šç¾©æ¸ˆã¿

    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é€²æ—ã®åˆæœŸåŒ–ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰
    document.addEventListener('DOMContentLoaded', function() {
        // ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã§ã¯é€²æ—ç®¡ç†ã¨ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ç„¡åŠ¹åŒ–
        const currentPath = window.location.pathname;
        if (currentPath.includes('/register') || currentPath.includes('/login')) {
            console.log('ğŸ“ ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®ãŸã‚ã€ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é€²æ—ã¨ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚');
            return;
        }

        // åˆå›æ›´æ–°ã‚’å°‘ã—é…ã‚‰ã›ã¦ progress-manager ã®åˆæœŸåŒ–ã‚’å¾…ã¤
        setTimeout(() => {
            updateFloatingProgress();
            // 30ç§’é–“éš”ã«å¤‰æ›´ï¼ˆé »åº¦ã‚’å‰Šæ¸›ï¼‰
            setInterval(updateFloatingProgress, 30000);
        }, 2000);
        
        // é€²æ—å¤‰æ›´æ™‚ã®å³åº§æ›´æ–°
        document.addEventListener('change', function(event) {
            if (event.target.classList.contains('progress-checkbox')) {
                setTimeout(updateFloatingProgress, 500);
            }
        });
        
        // ãƒšãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®æ›´æ–°
        window.addEventListener('focus', function() {
            updateFloatingProgress();
        });

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®åˆæœŸåŒ–
        setTimeout(() => {
            // åˆå›ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ãƒã‚§ãƒƒã‚¯
            const tutorialCompleted = localStorage.getItem('tutorialCompleted');
            const isHomePage = document.body.classList.contains('homepage');
            
            // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«è‡ªå‹•è¡¨ç¤ºã¯ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–
            // if (!tutorialCompleted && isHomePage) {
            //     showTutorial();
            // }
            
            // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒœã‚¿ãƒ³ã®åˆæœŸåŒ–ï¼ˆå¿…ãšå®Ÿè¡Œï¼‰
            setupTutorialButtons();
            
        }, 1000);
        
        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒœã‚¿ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        function setupTutorialButtons() {
            // ãƒ‰ãƒƒãƒˆã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆonclickã¨é‡è¤‡ã—ãªã„ã‚ˆã†ã«å‰Šé™¤ï¼‰
            // document.querySelectorAll('.dot').forEach((dot, index) => {
            //     dot.addEventListener('click', () => {
            //         goToTutorialStep(index + 1);
            //     });
            // });
            
            console.log('ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒœã‚¿ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸ');
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
        document.addEventListener('keydown', function(event) {
            // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            if (event.key === 'Escape') {
                const tutorialModal = document.getElementById('tutorialModal');
                const errorModal = document.getElementById('errorModal');
                const aiModal = document.getElementById('aiAssistantModal');
                
                if (tutorialModal && tutorialModal.classList.contains('show')) {
                    window.closeTutorial();
                    event.preventDefault();
                } else if (errorModal && errorModal.classList.contains('show')) {
                    closeErrorModal();
                    event.preventDefault();
                } else if (aiModal && aiModal.style.display === 'flex') {
                    closeAiAssistant();
                    event.preventDefault();
                }
            }
            
            // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å†…ã§ã®çŸ¢å°ã‚­ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            if (document.getElementById('tutorialModal')?.classList.contains('show')) {
                if (event.key === 'ArrowLeft') {
                    previousTutorialStep();
                    event.preventDefault();
                } else if (event.key === 'ArrowRight') {
                    nextTutorialStep();
                    event.preventDefault();
                }
            }
            
            // AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆé–‹ãã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ (Alt + A)
            if (event.altKey && event.key === 'a') {
                const aiBtn = document.getElementById('aiAssistantBtn');
                if (aiBtn) {
                    toggleAiAssistant();
                    event.preventDefault();
                }
            }
        });

        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹åˆ¶å¾¡ï¼‰
        function trapFocus(modal) {
            const focusableElements = modal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            modal.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
        }
    });
    </script>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='auth-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='api-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='progress-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='ai-assistant.js') }}"></script>
</body>
</html>